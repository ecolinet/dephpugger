#!/usr/local/bin/php
<?php

/* Needed for pcntl_signal(). */
require 'vendor/autoload.php';

foreach(glob(__DIR__ . '/../src/Dephpug/*.php') as $f) require_once $f;

use Dephpug\Config;

$config = Config::getInstance();

$projectPath = getcwd();
$phpPath = $config->server['phpPath'];
$defaultPort = $config->server['port'];
$defaultHost = $config->server['host'];
$debuggerPort = $config->debugger['port'];

$command = "{$phpPath} -S {$defaultHost}:{$defaultPort} -t {$projectPath} -dxdebug.remote_enable=1 -dxdebug.remote_mode=req -dxdebug.remote_port={$debuggerPort} -dxdebug.remote_host=127.0.0.1 -dxdebug.remote_connect_back=0";

$version = 'v' . file_get_contents(__DIR__ . '/../version');

echo <<<EOL
  _____             _                                       
 |  __ \           | |                                      
 | |  | | ___ _ __ | |__  _ __  _   _  __ _  __ _  ___ _ __ 
 | |  | |/ _ \ '_ \| '_ \| '_ \| | | |/ _` |/ _` |/ _ \ '__|
 | |__| |  __/ |_) | | | | |_) | |_| | (_| | (_| |  __/ |   
 |_____/ \___| .__/|_| |_| .__/ \__,_|\__, |\__, |\___|_|   
             | |         | |           __/ | __/ |          
             |_|         |_|          |___/ |___/           

                                   Server - Version: $version


EOL;

echo "Running command: {$command}\n\n";
echo "Access in {$defaultHost}:{$defaultPort}" . PHP_EOL;

shell_exec($command);
